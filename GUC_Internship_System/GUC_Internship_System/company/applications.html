<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Applications | SCAD System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../student/css/student_base.css">
    <link rel="stylesheet" href="../student/css/courses.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/company.css">
    <style>
      body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        background: linear-gradient(to bottom, #e3f2fd, #ffffff);
        color: #333;
      }
      
      /* Sidebar styles */
      .app-container {
        display: flex;
        min-height: 100vh;
      }
      
      .sidebar {
        width: 250px;
        background: linear-gradient(180deg, #0d1b2a 0%, #1b263b 100%);
        color: white;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        overflow-y: auto;
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease-in-out;
        z-index: 1000;
      }
      
      .sidebar-header {
        padding: 2rem 1rem;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }
      
      .sidebar-header h2 {
        margin: 0;
        font-size: 1.6rem;
        font-weight: 600;
        color: white;
      }
      
      .sidebar-nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      
      .nav-link {
        display: flex;
        align-items: center;
        padding: 1.2rem 2rem;
        color: white;
        text-decoration: none;
        font-size: 1.1rem;
        font-weight: 500;
        transition: background-color 0.3s ease, transform 0.2s ease;
      }
      
      .nav-link i {
        margin-right: 0.75rem;
        width: 20px;
        text-align: center;
      }
      
      .nav-link:hover {
        background-color: #2c3e50;
        transform: translateX(5px);
      }
      
      .nav-link.active {
        background-color: #001f3f;
        border-left: 4px solid #4CAF50;
        font-weight: 600;
      }
      
      /* Main content styles */
      .main-content {
        margin-left: 250px;
        flex: 1;
        background-color: #f4f8fc;
        padding-bottom: 2rem;
        transition: margin-left 0.3s ease-in-out;
        min-height: 100vh;
      }
      
      .main-header {
        background-color: #0d1b2a;
        color: #ffffff;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        position: relative;
        margin-bottom: 0;
      }
      
      .main-header h1 {
        margin: 0;
        font-size: 1.8rem;
        font-weight: 600;
        color: #ffffff;
      }
      
      /* Applications container styles */
      .applications-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 2rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      }
      
      .applications-container h2 {
        font-size: 1.5rem;
        color: #0d1b2a;
        text-align: center;
        margin-bottom: 1.5rem;
      }
      
      .applications-container h3 {
        font-size: 1.2rem;
        color: #0d1b2a;
        margin-top: 1.5rem;
        margin-bottom: 1rem;
      }
      
      /* Search and filter styles */
      .search-container, .filters {
        margin-bottom: 1.5rem;
      }
      
      .search-container label, .filters label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      
      .search-container input, .filters select {
        width: 100%;
        padding: 0.75rem;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 1rem;
        font-family: 'Inter', sans-serif;
      }
      
      /* Applications list styles */
      #applicationsPerPost, #applicationsList {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      
      #applicationsPerPost li, #applicationsList li {
        padding: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        background-color: #f9f9f9;
        transition: background-color 0.3s ease;
      }
      
      #applicationsList li {
        cursor: pointer;
      }
      
      #applicationsList li:hover {
        background-color: #e9e9e9;
      }
      
      /* Modal styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      
      .modal-content {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      }
      
      .modal-content h3 {
        color: #0d1b2a;
        margin-top: 0;
        margin-bottom: 1.5rem;
        text-align: center;
      }
      
      .modal-content p {
        margin: 0.5rem 0;
        font-size: 1.1rem;
      }
      
      .modal-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1.5rem;
        justify-content: space-between;
      }
      
      .modal-content button {
        background-color: #0d1b2a;
        color: white;
        border: none;
        padding: 0.75rem 1rem;
        border-radius: 6px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: background-color 0.3s ease;
        flex: 1;
        min-width: 120px;
      }
      
      .modal-content button:hover {
        background-color: #2c3e50;
      }
      
      .modal-content button.reject-btn {
        background-color: #c62828;
      }
      
      .modal-content button.reject-btn:hover {
        background-color: #b71c1c;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      /* Notification styles */
      .notification {
        position: fixed;
        top: 20px;
        right: -400px;
        max-width: 320px;
        padding: 14px 28px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        font-size: 1.1rem;
        z-index: 2000;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        transition: right 0.4s ease-in-out;
        animation: shake 0.3s ease-in-out;
      }

      .notification.show {
        right: 20px;
      }

      .notification.success {
        background-color: #388e3c;
      }

      .notification.error {
        background-color: #c62828;
      }

      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
      }

      .notification-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background-color: #ef4444;
        color: white;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        font-size: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .company-badge {
        position: absolute;
        top: 6px;
        right: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .company-badge img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
      }

      .company-badge span {
        font-size: 0.9rem;
        font-weight: 500;
        color: white;
        margin-top: 1px;
        text-align: center;
        max-width: 150px;
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <h2>Company Portal</h2>
        </div>
        <nav class="sidebar-nav">
          <ul>
            <li>
              <a href="company_dashboard.html" class="nav-link"
                ><i class="fas fa-home"></i>Dashboard</a
              >
            </li>
            <li>
              <a href="register.html" class="nav-link"
                ><i class="fas fa-user"></i>Register</a
              >
            </li>
            <li>
              <a href="upload-documents.html" class="nav-link"
                ><i class="fas fa-upload"></i>Upload Documents</a
              >
            </li>
            <li>
              <a href="job-posts.html" class="nav-link"
                ><i class="fas fa-briefcase"></i>Job Posts</a
              >
            </li>
            <li>
              <a href="evaluate.html" class="nav-link"
                ><i class="fas fa-star"></i>Evaluate Intern</a
              >
            </li>
            <li>
              <a href="applications.html" class="nav-link active"
                ><i class="fas fa-paper-plane"></i>Applications</a
              >
            </li>
            <li>
              <a href="currentinterns.html" class="nav-link"
                ><i class="fas fa-graduation-cap"></i>Current Interns</a
              >
            </li>
            
            <li><a href="../index.html" class="nav-link"><i class="fas fa-sign-out-alt"></i>Logout</a></li>
          </ul>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <header class="main-header">
          <header style="background-color: #0d1b2a; color: #ffffff; padding: 1.5rem; text-align: center; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); position: relative;">
            <h1 style="margin: 0; font-size: 1.8rem; font-weight: 600; color: #ffffff;">Applications</h1>
            
            <div style="position: absolute; top: 6px; right: 10px; display: flex; align-items: center; gap: 1.5rem;">
              <!-- Notification Icon -->
              <a href="company-notifications.html" style="color: white; text-decoration: none; position: relative;">
                <i class="fas fa-bell" style="font-size: 1.4rem;">
                  <span id="notificationBadge" style="position: absolute; top: -8px; right: -8px; background-color: #ef4444; color: white; 
                        border-radius: 50%; width: 18px; height: 18px; font-size: 0.75rem; display: flex; 
                        align-items: center; justify-content: center;">0</span>
                </i>
              </a>
              
              <!-- Company Badge -->
              <div style="display: flex; flex-direction: column; align-items: center;">
                <img src="../assets/company_badge.png" alt="Company Badge" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;">
                <span style="font-size: 0.9rem; font-weight: 500; color: white; margin-top: 1px; text-align: center; max-width: 150px;">Verified Company</span>
              </div>
            </div>
          </header>
        </header>
        <section class="applications-container">
          <h2>Internship Posts</h2>

          <!-- Search Feature -->
          <div class="search-container">
            <label for="searchPosts">Search Internship Posts:</label>
            <input
              type="text"
              id="searchPosts"
              placeholder="Search through the list of my company's internship posts only"
            />
          </div>

          <!-- Filter by Internship Post -->
          <div class="filters">
            <label for="filterApplicationsByPost">Filter by Post:</label>
            <select id="filterApplicationsByPost">
              <option value="">All Internship Posts</option>
            </select>
          </div>

          <!-- Applications Count per Post -->
          <div id="applicationsCount">
            <h3>Applications per Post</h3>
            <ul id="applicationsPerPost"></ul>
          </div>

          <!-- Applications List -->
          <div id="applicationsSection">
            <h3>All Applications</h3>
            <ul id="applicationsList"></ul>
          </div>
        </section>
      </main>
    </div>
    
    <!-- Applicant Details Modal -->
    <div id="applicantModal" class="modal">
      <div class="modal-content">
        <h3>Applicant Details</h3>
        <p id="applicantName"></p>
        <p id="applicantEmail"></p>
        <p id="applicantResume"></p>
        <div class="modal-buttons">
          <button id="finalizeApplicant">Finalize</button>
          <button id="acceptApplicant">Accept</button>
          <button id="rejectApplicant" class="reject-btn">Reject</button>
          <button id="setCurrentIntern">Set as Current Intern</button>
          <button id="setInternshipComplete">Set as Complete</button>
          <button id="closeModal">Close</button>
        </div>
      </div>
    </div>
    
    <script>
      // Populate the filter dropdown with internship posts
      function populateFilterDropdown(searchQuery = "") {
        const filterDropdown = document.getElementById(
          "filterApplicationsByPost"
        );
        const internshipPosts =
          JSON.parse(localStorage.getItem("jobPosts")) || [];
        filterDropdown.innerHTML =
          '<option value="">All Internship Posts</option>';
        internshipPosts
          .filter((post) =>
            post.title.toLowerCase().includes(searchQuery.toLowerCase())
          )
          .forEach((post) => {
            const option = document.createElement("option");
            option.value = post.title;
            option.textContent = post.title;
            filterDropdown.appendChild(option);
          });
      }

      // Populate applications count per post
      function populateApplicationsCount(searchQuery = "") {
        const applicationsPerPost = document.getElementById(
          "applicationsPerPost"
        );
        const jobPosts = JSON.parse(localStorage.getItem("jobPosts")) || [];
        applicationsPerPost.innerHTML = "";
        jobPosts
          .filter((post) =>
            post.title.toLowerCase().includes(searchQuery.toLowerCase())
          )
          .forEach((post) => {
            const li = document.createElement("li");
            li.textContent = `${post.title}: ${
              post.applications ? post.applications.length : 0
            } application(s)`;
            applicationsPerPost.appendChild(li);
          });
      }

      // Update applications count for the selected internship post or all posts
      function updateApplicationsCount() {
        const selectedPost = document.getElementById(
          "filterApplicationsByPost"
        ).value;
        const applicationsPerPost = document.getElementById(
          "applicationsPerPost"
        );
        applicationsPerPost.innerHTML = ""; // Clear the list

        const jobPosts = JSON.parse(localStorage.getItem("jobPosts")) || [];

        if (selectedPost) {
          // Display count for the selected internship post
          const selectedJob = jobPosts.find(
            (post) => post.title === selectedPost
          );

          if (selectedJob) {
            const count = selectedJob.applications
              ? selectedJob.applications.length
              : 0;
            const li = document.createElement("li");
            li.textContent = `${selectedJob.title}: ${count} application(s)`;
            applicationsPerPost.appendChild(li);
          }
        } else {
          // Display total count for all internship posts
          let totalApplications = 0;

          jobPosts.forEach((post) => {
            const count = post.applications ? post.applications.length : 0;
            totalApplications += count;

            const li = document.createElement("li");
            li.textContent = `${post.title}: ${count} application(s)`;
            applicationsPerPost.appendChild(li);
          });

          // Add a summary for the total applications
          const totalLi = document.createElement("li");
          totalLi.style.fontWeight = "bold";
          totalLi.textContent = `Total Applications: ${totalApplications}`;
          applicationsPerPost.appendChild(totalLi);
        }
      }

      // Filter internship posts based on search input
      function filterPostsBySearch() {
        const searchInput = document
          .getElementById("searchPosts")
          .value.toLowerCase();
        populateFilterDropdown(searchInput);
        populateApplicationsCount(searchInput);
        updateApplicationsList();
      }

      // Update applications list based on filter and search
      function updateApplicationsList() {
        const selectedPost = document.getElementById(
          "filterApplicationsByPost"
        ).value;
        const searchInput = document
          .getElementById("searchPosts")
          .value.toLowerCase();
        const applicationsList = document.getElementById("applicationsList");
        const jobPosts = JSON.parse(localStorage.getItem("jobPosts")) || [];
        applicationsList.innerHTML = "";

        jobPosts
          .filter((post) => post.title.toLowerCase().includes(searchInput))
          .forEach((post) => {
            if (selectedPost === "" || post.title === selectedPost) {
              (post.applications || []).forEach((application) => {
                const li = document.createElement("li");
                li.textContent = `Job: ${post.title} | Applicant: ${application.name}`;
                li.dataset.applicant = JSON.stringify(application);
                li.addEventListener("click", viewApplicantDetails);
                applicationsList.appendChild(li);
              });
            }
          });
      }

      // Attach event listener to the search input
      document
        .getElementById("searchPosts")
        .addEventListener("input", filterPostsBySearch);

      // Attach event listener to the filter dropdown
      document
        .getElementById("filterApplicationsByPost")
        .addEventListener("change", updateApplicationsList);

      // Attach event listener to the dropdown menu
      document
        .getElementById("filterApplicationsByPost")
        .addEventListener("change", updateApplicationsCount);

      // Add notification function
      function showNotification(message, type) {
        const notificationDiv = document.createElement('div');
        notificationDiv.textContent = message;
        notificationDiv.className = `notification ${type}`;
        notificationDiv.setAttribute('role', 'alert');
        document.body.appendChild(notificationDiv);

        // Force a reflow to ensure the animation works
        notificationDiv.offsetHeight;

        setTimeout(() => {
          notificationDiv.classList.add('show');
        }, 100);

        notificationDiv.addEventListener('click', () => {
          notificationDiv.classList.remove('show');
          setTimeout(() => notificationDiv.remove(), 300);
        });

        setTimeout(() => {
          notificationDiv.classList.remove('show');
          setTimeout(() => notificationDiv.remove(), 300);
        }, 5000);
      }

      // Update applicant status
      function updateApplicantStatus(applicant, status) {
        applicant.status = status;
        
        // Show appropriate notification based on status
        let message = '';
        switch(status) {
          case 'finalized':
            message = `Application for ${applicant.name} has been finalized!`;
            break;
          case 'accepted':
            message = `Application for ${applicant.name} has been accepted!`;
            break;
          case 'rejected':
            message = `Application for ${applicant.name} has been rejected.`;
            break;
          case 'current intern':
            message = `${applicant.name} has been set as a current intern!`;
            break;
          case 'internship complete':
            message = `Internship for ${applicant.name} has been marked as complete!`;
            break;
        }
        
        showNotification(message, status === 'rejected' ? 'error' : 'success');
        document.getElementById("applicantModal").style.display = "none";

        // Update the application in localStorage
        const jobPosts = JSON.parse(localStorage.getItem("jobPosts")) || [];
        jobPosts.forEach((post) => {
          if (post.applications) {
            post.applications.forEach((app) => {
              if (
                app.name === applicant.name &&
                app.email === applicant.email
              ) {
                app.status = status;
              }
            });
          }
        });
        localStorage.setItem("jobPosts", JSON.stringify(jobPosts));
        populateApplicationsCount(
          document.getElementById("searchPosts").value.toLowerCase()
        );
        updateApplicationsList();
      }

      // View applicant details
      function viewApplicantDetails(event) {
        const applicant = JSON.parse(event.target.dataset.applicant);
        document.getElementById(
          "applicantName"
        ).textContent = `Name: ${applicant.name}`;
        document.getElementById(
          "applicantEmail"
        ).textContent = `Email: ${applicant.email}`;
        document.getElementById(
          "applicantResume"
        ).textContent = `Resume: ${applicant.resume}`;
        
        // Display the modal
        document.getElementById("applicantModal").style.display = "flex";

        // Attach actions to buttons
        document.getElementById("finalizeApplicant").onclick = () =>
          updateApplicantStatus(applicant, "finalized");
        document.getElementById("acceptApplicant").onclick = () =>
          updateApplicantStatus(applicant, "accepted");
        document.getElementById("rejectApplicant").onclick = () =>
          updateApplicantStatus(applicant, "rejected");
        document.getElementById("setCurrentIntern").onclick = () =>
          updateApplicantStatus(applicant, "current intern");
        document.getElementById("setInternshipComplete").onclick = () =>
          updateApplicantStatus(applicant, "internship complete");
        document.getElementById("closeModal").onclick = () =>
          document.getElementById("applicantModal").style.display = "none";
      }
      
      // Close modal if user clicks outside of it
      window.addEventListener("click", function(event) {
        const modal = document.getElementById("applicantModal");
        if (event.target === modal) {
          modal.style.display = "none";
        }
      });

      // Initialize the page
      document.addEventListener("DOMContentLoaded", function() {
        populateFilterDropdown();
        updateApplicationsCount();
        updateApplicationsList();
        
        // Add event listener to filter dropdown
        document.getElementById("filterApplicationsByPost").addEventListener("change", function() {
          updateApplicationsCount();
          updateApplicationsList();
        });
      });

      // Add notification badge functionality
      function updateNotificationBadge() {
        // This would typically fetch the actual count from your backend
        const unreadCount = 3; // Example count
        const badge = document.getElementById('notificationBadge');
        badge.textContent = unreadCount;
        badge.style.display = unreadCount > 0 ? 'flex' : 'none';
      }

      window.onload = function() {
        updateNotificationBadge();
      };
    </script>
  </body>
</html>
