<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Applications</title>
    <link rel="stylesheet" href="GUC_Internship_System/css/applications.css" />
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <!-- Fixed Header -->
    <header class="fixed-header">
      <h1>Internship posts and Applications</h1>
    </header>
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Company Portal</h2>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li>
            <a href="company_dashboard.html" class="nav-link">
              <i class="fas fa-home"></i> Dashboard
            </a>
          </li>
          <li>
            <a href="register.html" class="nav-link">
              <i class="fas fa-user"></i> Register
            </a>
          </li>
          <li>
            <a href="upload-documents.html" class="nav-link">
              <i class="fas fa-upload"></i> Upload Documents
            </a>
          </li>
          <li>
            <a href="job-posts.html" class="nav-link">
              <i class="fas fa-briefcase"></i> Job Posts
            </a>
          </li>
          <li>
            <a href="evaluate.html" class="nav-link">
              <i class="fas fa-star"></i> Evaluate Intern
            </a>
          </li>
          <li>
            <a href="applications.html" class="nav-link">
              <i class="fas fa-paper-plane"></i> Applications
            </a>
          </li>
          <li>
            <a href="currentinterns.html" class="nav-link">
              <i class="fas fa-graduation-cap"></i> Current Interns
            </a>
          </li>
        </ul>
      </nav>
    </aside>
    <main>
      <div class="applications-container">
        <h2>Internship Posts</h2>

        <!-- Search Feature -->
        <div class="search-container">
          <label for="searchPosts">Search Internship Posts:</label>
          <input
            type="text"
            id="searchPosts"
            placeholder="Search through the list of my company's internship posts only"
          />
        </div>

        <!-- Filter by Internship Post -->
        <div class="filters">
          <select id="filterApplicationsByPost">
            <option value="">All Internship Posts</option>
          </select>
        </div>

        <!-- Applications Count per Post -->
        <div id="applicationsCount" style="margin-top: 20px">
          <h3>Applications per Post</h3>
          <ul id="applicationsPerPost"></ul>
        </div>

        <!-- Applications List -->
        <div id="applicationsSection" style="margin-top: 20px">
          <h3>All Applications</h3>
          <ul id="applicationsList"></ul>
        </div>

        <div
          id="applicantDetails"
          style="
            display: none;
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 20px;
          "
        >
          <h4>Applicant Details</h4>
          <p id="applicantName"></p>
          <p id="applicantEmail"></p>
          <p id="applicantResume"></p>
          <div>
            <button id="finalizeApplicant">Finalize</button>
            <button id="acceptApplicant">Accept</button>
            <button id="rejectApplicant">Reject</button>
            <button id="setCurrentIntern">Set as Current Intern</button>
            <button id="setInternshipComplete">
              Set as Internship Complete
            </button>
          </div>
        </div>
      </div>
    </main>
    <script>
      // Populate the filter dropdown with internship posts
      function populateFilterDropdown() {
        const filterDropdown = document.getElementById(
          "filterApplicationsByPost"
        );
        const internshipPosts =
          JSON.parse(localStorage.getItem("jobPosts")) || [];
        filterDropdown.innerHTML =
          '<option value="">All Internship Posts</option>';
        internshipPosts.forEach((post) => {
          const option = document.createElement("option");
          option.value = post.title;
          option.textContent = post.title;
          filterDropdown.appendChild(option);
        });
      }

      // Filter internship posts based on search input
      function filterPostsBySearch() {
        const searchInput = document
          .getElementById("searchPosts")
          .value.toLowerCase();
        const filterDropdown = document.getElementById(
          "filterApplicationsByPost"
        );
        const internshipPosts =
          JSON.parse(localStorage.getItem("jobPosts")) || [];

        filterDropdown.innerHTML =
          '<option value="">All Internship Posts</option>';
        internshipPosts
          .filter((post) => post.title.toLowerCase().includes(searchInput))
          .forEach((post) => {
            const option = document.createElement("option");
            option.value = post.title;
            option.textContent = post.title;
            filterDropdown.appendChild(option);
          });
      }

      // Attach event listener to the search input
      document
        .getElementById("searchPosts")
        .addEventListener("input", filterPostsBySearch);

      document
        .getElementById("filterApplicationsByPost")
        .addEventListener("change", function () {
          const selectedPost = this.value;
          const jobPosts = JSON.parse(localStorage.getItem("jobPosts")) || [];
          const applicationsList = document.getElementById("applicationsList");
          applicationsList.innerHTML = "";

          jobPosts.forEach((post) => {
            if (selectedPost === "" || post.title === selectedPost) {
              post.applications.forEach((application) => {
                const li = document.createElement("li");
                li.textContent = `Job: ${post.title} | Applicant: ${application.name}`;
                li.dataset.applicant = JSON.stringify(application);
                li.addEventListener("click", viewApplicantDetails);
                applicationsList.appendChild(li);
              });
            }
          });
        });

      // Update applicant status
      function updateApplicantStatus(applicant, status) {
        applicant.status = status;
        alert(`Applicant ${applicant.name} has been marked as ${status}.`);
        document.getElementById("applicantDetails").style.display = "none";

        // Update the application in localStorage (if needed)
        const jobPosts = JSON.parse(localStorage.getItem("jobPosts")) || [];
        jobPosts.forEach((post) => {
          post.applications.forEach((app) => {
            if (app.name === applicant.name && app.email === applicant.email) {
              app.status = status;
            }
          });
        });
        localStorage.setItem("jobPosts", JSON.stringify(jobPosts));
      }

      // View applicant details
      function viewApplicantDetails(event) {
        const applicant = JSON.parse(event.target.dataset.applicant);
        document.getElementById(
          "applicantName"
        ).textContent = `Name: ${applicant.name}`;
        document.getElementById(
          "applicantEmail"
        ).textContent = `Email: ${applicant.email}`;
        document.getElementById(
          "applicantResume"
        ).textContent = `Resume: ${applicant.resume}`;
        document.getElementById("applicantDetails").style.display = "block";

        // Attach actions to buttons
        document.getElementById("finalizeApplicant").onclick = () =>
          updateApplicantStatus(applicant, "finalized");
        document.getElementById("acceptApplicant").onclick = () =>
          updateApplicantStatus(applicant, "accepted");
        document.getElementById("rejectApplicant").onclick = () =>
          updateApplicantStatus(applicant, "rejected");
        document.getElementById("setCurrentIntern").onclick = () =>
          updateApplicantStatus(applicant, "current intern");
        document.getElementById("setInternshipComplete").onclick = () =>
          updateApplicantStatus(applicant, "internship complete");
      }

      // Populate the dropdown on page load
      populateFilterDropdown();
    </script>
  </body>
</html>
